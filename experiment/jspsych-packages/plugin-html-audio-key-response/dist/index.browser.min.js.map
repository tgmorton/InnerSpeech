{"version":3,"file":"index.browser.min.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"html-audio-response\",\n  parameters: {\n    /** The HTML string to be displayed */\n    stimulus: {\n      type: ParameterType.HTML_STRING,\n      default: undefined,\n    },\n    /** How long to show the stimulus. */\n    stimulus_duration: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /** How long to show the trial. */\n    recording_duration: {\n      type: ParameterType.INT,\n      default: 2000,\n    },\n    /** Whether or not to show a button to end the recording. If false, the recording_duration must be set. */\n    show_done_button: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n    /** Label for the done (stop recording) button. Only used if show_done_button is true. */\n    done_button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** Label for the record again button (only used if allow_playback is true). */\n    record_again_button_label: {\n      type: ParameterType.STRING,\n      default: \"Record again\",\n    },\n    /** Label for the button to accept the audio recording (only used if allow_playback is true). */\n    accept_button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** Whether or not to allow the participant to playback the recording and either accept or re-record. */\n    allow_playback: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Whether or not to save the video URL to the trial data. */\n    save_audio_url: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Whether or not to use the voice-key functionality. */\n    use_voice_key: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** The amplitude threshold for the voice-key. */\n    amplitude_threshold: {\n      type: ParameterType.FLOAT,\n      default: 0.1,\n    },\n    /** The duration of the timer that starts when the amplitude threshold is surpassed. */\n    timer_duration: {\n      type: ParameterType.INT,\n      default: 350,\n    },\n    alert_sound: {\n      type: ParameterType.AUDIO,\n      pretty_name: \"alert_sound Sound\",\n      default: undefined,\n    },\n    alert_image: {\n      type: ParameterType.IMAGE,\n      pretty_name: \"Alert Image\",\n      default: undefined,\n    }\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * html-audio-response\n * jsPsych plugin for displaying a stimulus and recording an audio response through a microphone\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/plugins/jspsych-html-audio-response/ html-audio-response plugin documentation on jspsych.org}\n */\nclass HtmlAudioResponsePlugin implements JsPsychPlugin<Info> {\n  static info = info;\n  private stimulus_start_time;\n  private recorder_start_time;\n  private recorder: MediaRecorder;\n  private audio_url;\n  private response;\n  private load_resolver;\n  private rt: number = null;\n  private start_event_handler;\n  private stop_event_handler;\n  private data_available_handler;\n  private recorded_data_chunks = [];\n  private analyzer: any; // Add this property to store the analyzer\n  private dataArray: any; // Add this property to store the data array\n  private bufferLength: any; // Add this property to store the buffer length\n  private amplitudeThreshold: any; // Add this property to store the amplitude threshold\n  private startTime: any; // Add this property to store the start time\n  private timeout: any;\n  private alert_sound;\n  private triggerTime: any;\n  private triggerLatency: any;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var startTime;\n\n    var context = this.jsPsych.pluginAPI.audioContext();\n\n    // load alert_sound file\n    this.jsPsych.pluginAPI\n      .getAudioBuffer(trial.alert_sound)\n      .then((buffer) => {\n        if (context !== null) {\n          this.alert_sound = context.createBufferSource();\n          this.alert_sound.buffer = buffer;\n          this.alert_sound.connect(context.destination);\n        } else {\n          this.alert_sound = buffer;\n          this.alert_sound.currentTime = 0;\n        }\n      })\n      .catch((err) => {\n        console.error(\n          `Failed to load audio file \"${trial.stimulus}\". Try checking the file path. We recommend using the preload plugin to load audio files.`\n        );\n        console.error(err);\n      });\n    \n    this.recorder = this.jsPsych.pluginAPI.getMicrophoneRecorder();\n\n    this.setupRecordingEvents(display_element, trial);\n\n    this.startRecording(trial);\n  }\n\n  private showDisplay(display_element, trial) {\n    const ro = new ResizeObserver((entries, observer) => {\n      this.stimulus_start_time = performance.now();\n      observer.unobserve(display_element);\n      //observer.disconnect();\n    });\n\n    ro.observe(display_element);\n\n    let html = `<div id=\"jspsych-html-audio-response-stimulus\">${trial.stimulus}</div>`;\n    html += `<div id=\"alert-image\" style=\"position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); opacity: 0; \">\n                <img src=\"${trial.alert_image}\" style=\"width: 250px;\">\n             </div>`;\n    \n    if (trial.show_done_button) {\n      html += `<p><button class=\"jspsych-btn\" id=\"finish-trial\">${trial.done_button_label}</button></p>`;\n    }\n\n    display_element.innerHTML = html;\n  }\n\n  private hideStimulus(display_element: HTMLElement) {\n    const el: HTMLElement = display_element.querySelector(\"#jspsych-html-audio-response-stimulus\");\n    if (el) {\n      el.style.visibility = \"hidden\";\n    }\n    const alertImage: HTMLElement = document.getElementById(\"alert-image\");\n    if (alertImage) {\n      alertImage.style.opacity = \"0\";\n    }\n  }\n\n  private showAlertImage() {\n    const alertImage: HTMLElement = document.getElementById(\"alert-image\");\n    if (alertImage) {\n      alertImage.style.opacity = \"1\";\n    }\n  }\n\n  private changeDisplay(display_element: HTMLElement, newContent: string) {\n    display_element.innerHTML = newContent;\n  }\n\n  private addButtonEvent(display_element, trial) {\n    const btn = display_element.querySelector(\"#finish-trial\");\n    if (btn) {\n      btn.addEventListener(\"click\", () => {\n        const end_time = performance.now();\n        this.rt = Math.round(end_time - this.stimulus_start_time);\n        this.stopRecording().then(() => {\n          if (trial.allow_playback) {\n            this.showPlaybackControls(display_element, trial);\n          } else {\n            this.endTrial(display_element, trial);\n          }\n        });\n      });\n    }\n  }\n\n  private setupRecordingEvents(display_element, trial) {\n    this.data_available_handler = (e) => {\n      if (e.data.size > 0) {\n        this.recorded_data_chunks.push(e.data);\n      }\n    };\n\n    this.stop_event_handler = () => {\n      const data = new Blob(this.recorded_data_chunks, { type: \"audio/webm\" });\n      this.audio_url = URL.createObjectURL(data);\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", () => {\n        const base64 = (reader.result as string).split(\",\")[1];\n        this.response = base64;\n        this.load_resolver();\n      });\n      reader.readAsDataURL(data);\n    };\n\n    this.start_event_handler = (e) => {\n      // resets the recorded data\n      this.recorded_data_chunks.length = 0;\n\n      this.recorder_start_time = e.timeStamp;\n      this.showDisplay(display_element, trial);\n      this.addButtonEvent(display_element, trial);\n\n      // setup timer for hiding the stimulus\n      if (trial.stimulus_duration !== null) {\n        this.jsPsych.pluginAPI.setTimeout(() => {\n          this.hideStimulus(display_element);\n        }, trial.stimulus_duration);\n      }\n\n      // setup timer for ending the trial\n      if (trial.recording_duration !== null) {\n        this.jsPsych.pluginAPI.setTimeout(() => {\n          // this check is necessary for cases where the\n          // done_button is clicked before the timer expires\n          if (this.recorder.state !== \"inactive\") {\n            this.stopRecording().then(() => {\n              if (trial.allow_playback) {\n                this.showPlaybackControls(display_element, trial);\n              } else {\n                this.endTrial(display_element, trial);\n              }\n            });\n          }\n        }, trial.recording_duration);\n      }\n    };\n\n    this.recorder.addEventListener(\"dataavailable\", this.data_available_handler);\n\n    this.recorder.addEventListener(\"stop\", this.stop_event_handler);\n\n    this.recorder.addEventListener(\"start\", this.start_event_handler);\n  }\n\n  private injectInvertColorsCSS() {\n    const style = document.createElement('style');\n    style.textContent = `\n      body {\n        filter: invert(1);\n      }\n    `;\n    document.head.append(style);\n  }\n\n  private logAmplitudeUntilThresholdReached(trial) {\n    return new Promise((resolve, reject) => {\n      const logAmplitude = () => {\n        // Get the audio data from the analyzer\n        this.analyzer.getByteTimeDomainData(this.dataArray);\n  \n        // Calculate the amplitude\n        let sum = 0;\n        for (let i = 0; i < this.bufferLength; i++) {\n          const value = (this.dataArray[i] - 128) / 128;\n          sum += value * value;\n        }\n        const amplitude = Math.sqrt(sum / this.bufferLength);\n        //console.log(trial.amplitude_threshold);\n  \n        // If the amplitude exceeds the threshold, resolve the promise\n        if (amplitude > trial.amplitude_threshold) {\n          const endTime = performance.now(); // Store the end time\n          console.log(`Time from start to amplitude log: ${endTime - this.startTime} ms`);\n          resolve('Amplitude threshold reached');\n          return;\n        }\n  \n        // If the timeout has been reached, reject the promise\n        if (Date.now() - this.startTime > this.timeout) {\n          reject('Timeout reached');\n          return;\n        }\n  \n        // Schedule the next log\n        this.jsPsych.pluginAPI.setTimeout(logAmplitude, 5); // Adjust the time interval as needed (in milliseconds)\n      };\n  \n      logAmplitude();\n    });\n  }\n\n  private playAlertSound() {\n    if (this.alert_sound) {\n      if (this.alert_sound instanceof AudioBufferSourceNode) {\n        this.alert_sound.start();\n      } else {\n        this.alert_sound.play();\n      }\n    }\n  }\n\n  private startRecording(trial) {\n    // Initialize the analyzer\n    const audioContext = new AudioContext();\n    const source = audioContext.createMediaStreamSource(this.recorder.stream);\n    this.analyzer = audioContext.createAnalyser();\n    source.connect(this.analyzer);\n    this.bufferLength = this.analyzer.frequencyBinCount\n    this.dataArray = new Uint8Array(this.bufferLength);\n    \n    this.recorder.start();\n    this.startTime = performance.now(); // Store the start time\n    this.jsPsych.pluginAPI.setTimeout(() => {\n      this.logAmplitudeUntilThresholdReached(trial)\n      .then(\n        message => {\n          console.log(message);\n          var triggerTimeRaw = performance.now()\n          this.triggerTime = triggerTimeRaw - this.startTime\n          console.log(this.triggerTime)\n          this.jsPsych.pluginAPI.setTimeout(() => {\n            if (trial.use_voice_key) {\n              this.showAlertImage();\n              this.playAlertSound();\n            }\n            this.triggerLatency = performance.now() - triggerTimeRaw\n            console.log(this.triggerLatency)\n          }, trial.timer_duration);\n        }\n        )\n      .catch(error => console.error(error));\n      }, 100);\n  }\n\n  private stopRecording() {\n    this.recorder.stop();\n    return new Promise((resolve) => {\n      this.load_resolver = resolve;\n    });\n  }\n\n  private showPlaybackControls(display_element, trial) {\n    display_element.innerHTML = `\n      <p><audio id=\"playback\" src=\"${this.audio_url}\" controls></audio></p>\n      <button id=\"record-again\" class=\"jspsych-btn\">${trial.record_again_button_label}</button>\n      <button id=\"continue\" class=\"jspsych-btn\">${trial.accept_button_label}</button>\n    `;\n\n    display_element.querySelector(\"#record-again\").addEventListener(\"click\", () => {\n      // release object url to save memory\n      URL.revokeObjectURL(this.audio_url);\n      this.startRecording(trial);\n    });\n    display_element.querySelector(\"#continue\").addEventListener(\"click\", () => {\n      this.endTrial(display_element, trial);\n    });\n\n    // const audio = display_element.querySelector('#playback');\n    // audio.src =\n  }\n\n  private endTrial(display_element, trial) {\n    // clear recordering event handler\n\n    this.recorder.removeEventListener(\"dataavailable\", this.data_available_handler);\n    this.recorder.removeEventListener(\"start\", this.start_event_handler);\n    this.recorder.removeEventListener(\"stop\", this.stop_event_handler);\n\n    // kill any remaining setTimeout handlers\n    this.jsPsych.pluginAPI.clearAllTimeouts();\n\n    // gather the data to store for the trial\n    var trial_data: any = {\n      rt: this.rt,\n      stimulus: trial.stimulus,\n      response: this.response,\n      estimated_stimulus_onset: Math.round(this.stimulus_start_time - this.recorder_start_time),\n      trigger_time: this.triggerTime,\n      trigger_latency: this.triggerLatency\n    };\n\n    if (trial.save_audio_url) {\n      trial_data.audio_url = this.audio_url;\n    } else {\n      URL.revokeObjectURL(this.audio_url);\n    }\n\n    // clear the display\n    display_element.innerHTML = \"\";\n\n    // move on to the next trial\n    this.jsPsych.finishTrial(trial_data);\n  }\n}\n\nexport default HtmlAudioResponsePlugin;\n"],"names":["info","name","parameters","stimulus","type","ParameterType","HTML_STRING","default","undefined","stimulus_duration","INT","recording_duration","show_done_button","BOOL","done_button_label","STRING","record_again_button_label","accept_button_label","allow_playback","save_audio_url","use_voice_key","amplitude_threshold","FLOAT","timer_duration","alert_sound","AUDIO","pretty_name","alert_image","IMAGE","HtmlAudioResponsePlugin","jsPsych","_classCallCheck","this","rt","recorded_data_chunks","display_element","trial","_this","context","pluginAPI","audioContext","getAudioBuffer","then","buffer","createBufferSource","connect","destination","currentTime","err","console","error","recorder","getMicrophoneRecorder","setupRecordingEvents","startRecording","_this2","ResizeObserver","entries","observer","stimulus_start_time","performance","now","unobserve","observe","html","concat","innerHTML","value","el","querySelector","style","visibility","alertImage","document","getElementById","opacity","newContent","_this3","btn","addEventListener","end_time","Math","round","stopRecording","showPlaybackControls","endTrial","_this4","data_available_handler","e","data","size","push","stop_event_handler","Blob","audio_url","URL","createObjectURL","reader","FileReader","base64","result","split","response","load_resolver","readAsDataURL","start_event_handler","length","recorder_start_time","timeStamp","showDisplay","addButtonEvent","setTimeout","hideStimulus","state","createElement","textContent","head","append","_this5","Promise","resolve","reject","logAmplitude","analyzer","getByteTimeDomainData","dataArray","sum","i","bufferLength","sqrt","endTime","log","startTime","Date","timeout","AudioBufferSourceNode","start","play","_this6","AudioContext","source","createMediaStreamSource","stream","createAnalyser","frequencyBinCount","Uint8Array","logAmplitudeUntilThresholdReached","message","triggerTimeRaw","triggerTime","showAlertImage","playAlertSound","triggerLatency","_this7","stop","_this8","revokeObjectURL","removeEventListener","clearAllTimeouts","trial_data","estimated_stimulus_onset","trigger_time","trigger_latency","finishTrial"],"mappings":"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"}