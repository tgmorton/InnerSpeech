{"version":3,"file":"index.browser.min.js","sources":["../src/index.ts"],"sourcesContent":["import { JsPsych, JsPsychPlugin, ParameterType, TrialType } from \"jspsych\";\n\nconst info = <const>{\n  name: \"html-audio-response\",\n  parameters: {\n    /** The HTML string to be displayed */\n    stimulus: {\n      type: ParameterType.HTML_STRING,\n      default: undefined,\n    },\n    /** How long to show the stimulus. */\n    stimulus_duration: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /** How long to show the trial. */\n    recording_duration: {\n      type: ParameterType.INT,\n      default: null,\n    },\n    /** Whether or not to show a button to end the recording. If false, the recording_duration must be set. */\n    show_done_button: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n    /** Label for the done (stop recording) button. Only used if show_done_button is true. */\n    done_button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** Label for the record again button (only used if allow_playback is true). */\n    record_again_button_label: {\n      type: ParameterType.STRING,\n      default: \"Record again\",\n    },\n    /** Label for the button to accept the audio recording (only used if allow_playback is true). */\n    accept_button_label: {\n      type: ParameterType.STRING,\n      default: \"Continue\",\n    },\n    /** Whether or not to allow the participant to playback the recording and either accept or re-record. */\n    allow_playback: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Whether or not to save the video URL to the trial data. */\n    save_audio_url: {\n      type: ParameterType.BOOL,\n      default: false,\n    },\n    /** Whether or not to use the voice-key functionality. */\n    use_voice_key: {\n      type: ParameterType.BOOL,\n      default: true,\n    },\n    /** The amplitude threshold for the voice-key. */\n    amplitude_threshold: {\n      type: ParameterType.FLOAT,\n      default: 0.1,\n    },\n    /** The duration of the timer that starts when the amplitude threshold is surpassed. */\n    timer_duration: {\n      type: ParameterType.INT,\n      default: 350,\n    },\n\n  },\n};\n\ntype Info = typeof info;\n\n/**\n * html-audio-response\n * jsPsych plugin for displaying a stimulus and recording an audio response through a microphone\n * @author Josh de Leeuw\n * @see {@link https://www.jspsych.org/plugins/jspsych-html-audio-response/ html-audio-response plugin documentation on jspsych.org}\n */\nclass HtmlAudioResponsePlugin implements JsPsychPlugin<Info> {\n  static info = info;\n  private stimulus_start_time;\n  private recorder_start_time;\n  private recorder: MediaRecorder;\n  private response;\n  private load_resolver;\n  private rt: number = null;\n  private start_event_handler;\n  private stop_event_handler;\n  private data_available_handler;\n  private recorded_data_chunks = [];\n  private analyzer: any; // Add this property to store the analyzer\n  private dataArray: any; // Add this property to store the data array\n  private bufferLength: any; // Add this property to store the buffer length\n  private amplitudeThreshold: any; // Add this property to store the amplitude threshold\n  private startTime: any; // Add this property to store the start time\n  private timeout: any;\n  private meter = null;\n  private canvasContext = null;\n  private isLoggingAmplitude: boolean = false;\n  private amplitudeLoggingTimeoutId: number | null = null;\n\n  constructor(private jsPsych: JsPsych) {}\n\n  trial(display_element: HTMLElement, trial: TrialType<Info>) {\n    var startTime;\n\n    var context = this.jsPsych.pluginAPI.audioContext();\n    \n    this.recorder = this.jsPsych.pluginAPI.getMicrophoneRecorder();\n\n    this.setupRecordingEvents(display_element, trial);\n\n    this.startRecording(trial);\n  }\n\n  private showDisplay(display_element, trial) {\n    const ro = new ResizeObserver((entries, observer) => {\n      this.stimulus_start_time = performance.now();\n      observer.unobserve(display_element);\n      //observer.disconnect();\n    });\n\n    ro.observe(display_element);\n\n    console.log(\"here0\")\n\n    let html = `<div id=\"jspsych-html-audio-response-stimulus\">${trial.stimulus}</div>` +\n               '<canvas id=\"meter\" width=\"500\" height=\"50\"></canvas>' +\n               `<div id=\"threshold-display\">Threshold: ${trial.amplitude_threshold.toFixed(3)}</div>` +\n               '<button id=\"decrease-threshold\" class=\"jspsych-btn\">-</button>' +\n               '<button id=\"increase-threshold\" class=\"jspsych-btn\">+</button>';;\n    \n    if (trial.show_done_button) {\n      html += `<p><button class=\"jspsych-btn\" id=\"finish-trial\">${trial.done_button_label}</button></p>`;\n    }\n\n    display_element.innerHTML = html;\n\n    this.startAmplitudeLogging(trial);\n      // Add event listeners for the buttons\n    document.getElementById('increase-threshold').addEventListener('click', () => {\n      this.stopAmplitudeLogging();\n      trial.amplitude_threshold = Math.min(trial.amplitude_threshold + 0.025, 1); // Assuming the threshold max is 1\n      document.getElementById('threshold-display').textContent = `Threshold: ${trial.amplitude_threshold.toFixed(3)}`;\n      this.startAmplitudeLogging(trial);\n    });\n\n    document.getElementById('decrease-threshold').addEventListener('click', () => {\n      this.stopAmplitudeLogging();\n      trial.amplitude_threshold = Math.max(trial.amplitude_threshold - 0.025, 0); // Assuming the threshold min is 0\n      document.getElementById('threshold-display').textContent = `Threshold: ${trial.amplitude_threshold.toFixed(3)}`;\n      this.startAmplitudeLogging(trial);\n    });\n\n  }\n\n  private hideStimulus(display_element: HTMLElement) {\n    const el: HTMLElement = display_element.querySelector(\"#jspsych-html-audio-response-stimulus\");\n    if (el) {\n      el.style.visibility = \"hidden\";\n    }\n    const alertImage: HTMLElement = document.getElementById(\"alert-image\");\n    if (alertImage) {\n      alertImage.style.opacity = \"0\";\n    }\n  }\n\n  private addButtonEvent(display_element, trial) {\n    const btn = display_element.querySelector(\"#finish-trial\");\n    if (btn) {\n      btn.addEventListener(\"click\", () => {\n        const end_time = performance.now();\n        this.rt = Math.round(end_time - this.stimulus_start_time);\n        this.stopRecording().then(() => {\n          if (trial.allow_playback) {\n            this.showPlaybackControls(display_element, trial);\n          } else {\n            this.endTrial(display_element, trial);\n          }\n        });\n      });\n    }\n  }\n\n  private setupRecordingEvents(display_element, trial) {\n    this.data_available_handler = (e) => {\n      if (e.data.size > 0) {\n        this.recorded_data_chunks.push(e.data);\n      }\n    };\n\n    this.stop_event_handler = () => {\n      const data = new Blob(this.recorded_data_chunks, { type: \"audio/webm\" });\n      const reader = new FileReader();\n      reader.addEventListener(\"load\", () => {\n        const base64 = (reader.result as string).split(\",\")[1];\n        this.response = base64;\n        this.load_resolver();\n      });\n      reader.readAsDataURL(data);\n    };\n\n    this.start_event_handler = (e) => {\n      // resets the recorded data\n      this.recorded_data_chunks.length = 0;\n\n      this.recorder_start_time = e.timeStamp;\n      this.showDisplay(display_element, trial);\n      this.addButtonEvent(display_element, trial);\n\n      // setup timer for hiding the stimulus\n      if (trial.stimulus_duration !== null) {\n        this.jsPsych.pluginAPI.setTimeout(() => {\n          this.hideStimulus(display_element);\n        }, trial.stimulus_duration);\n      }\n\n      // setup timer for ending the trial\n      if (trial.recording_duration !== null) {\n        this.jsPsych.pluginAPI.setTimeout(() => {\n          // this check is necessary for cases where the\n          // done_button is clicked before the timer expires\n          if (this.recorder.state !== \"inactive\") {\n            this.stopRecording().then(() => {\n              if (trial.allow_playback) {\n                this.showPlaybackControls(display_element, trial);\n              } else {\n                this.endTrial(display_element, trial);\n              }\n            });\n          }\n        }, trial.recording_duration);\n      }\n    };\n\n    this.recorder.addEventListener(\"dataavailable\", this.data_available_handler);\n\n    this.recorder.addEventListener(\"stop\", this.stop_event_handler);\n\n    this.recorder.addEventListener(\"start\", this.start_event_handler);\n  }\n\n  private drawVolumeMeter(amplitude: number, threshold: number) {\n    console.log(\"here4\")\n    if (!this.canvasContext) {\n      this.canvasContext = (document.getElementById(\"meter\") as HTMLCanvasElement).getContext(\"2d\");\n    }\n    const canvas = this.canvasContext.canvas;\n    this.canvasContext.clearRect(0, 0, canvas.width, canvas.height); // Clear previous drawing\n  \n    const scaledAmplitude = amplitude / threshold;\n    const width = Math.min(scaledAmplitude, 1) * canvas.width; // Ensure the width does not exceed the canvas width\n    this.canvasContext.fillStyle = amplitude > threshold ? 'red' : 'green';\n    this.canvasContext.fillRect(0, 0, width, canvas.height); // Draw the volume level as a filled rectangle\n  }\n\n  private stopAmplitudeLogging() {\n    this.isLoggingAmplitude = false;\n    if (this.amplitudeLoggingTimeoutId !== null) {\n      this.amplitudeLoggingTimeoutId = null;\n    }\n  }\n\n  private startAmplitudeLogging(trial: TrialType<Info>) {\n    this.stopAmplitudeLogging(); // Ensure any previous logging is stopped\n    this.logAmplitudeUntilThresholdReached(trial, trial.amplitude_threshold)\n      .then(message => {\n        console.log(message); // Handle message\n      })\n      .catch(error => {\n        console.error(error); // Handle error\n      });\n  }\n\n  private logAmplitudeUntilThresholdReached(trial, threshold) {\n    return new Promise((resolve, reject) => {\n      console.log(\"here2\")\n      const logAmplitude = () => {\n        if (!this.isLoggingAmplitude) {\n          resolve('Amplitude logging stopped');\n          return;\n        }\n        // Get the audio data from the analyzer\n        this.analyzer.getByteTimeDomainData(this.dataArray);\n  \n        // Calculate the amplitude\n        let sum = 0;\n        for (let i = 0; i < this.bufferLength; i++) {\n          const value = (this.dataArray[i] - 128) / 128;\n          sum += value * value;\n        }\n        const amplitude = Math.sqrt(sum / this.bufferLength);\n\n        //console.log(trial.amplitude_threshold);\n\n        this.drawVolumeMeter(amplitude, threshold);\n  \n        // If the amplitude exceeds the threshold, resolve the promise\n        if (amplitude > threshold) {\n          const endTime = performance.now(); // Store the end time\n          console.log(`Time from start to amplitude log: ${endTime - this.startTime} ms`);\n          //resolve('Amplitude threshold reached');\n          //return;\n        }\n  \n        // If the timeout has been reached, reject the promise\n        if (Date.now() - this.startTime > this.timeout) {\n          reject('Timeout reached');\n          return;\n        }\n  \n        // Schedule the next log if still logging\n        if (this.isLoggingAmplitude) {\n          this.amplitudeLoggingTimeoutId = this.jsPsych.pluginAPI.setTimeout(logAmplitude, 16.67);\n        }      \n      };\n  \n      this.isLoggingAmplitude = true;\n      logAmplitude();\n    });\n  }\n\n  private startRecording(trial) {\n    // Initialize the analyzer\n    const audioContext = new AudioContext();\n    const source = audioContext.createMediaStreamSource(this.recorder.stream);\n    this.analyzer = audioContext.createAnalyser();\n    source.connect(this.analyzer);\n    this.bufferLength = this.analyzer.frequencyBinCount\n    this.dataArray = new Uint8Array(this.bufferLength);\n    \n    this.recorder.start();\n    this.startTime = performance.now(); // Store the start time\n    // while the experiment is running\n    console.log(\"here\")\n  }\n\n  private stopRecording() {\n    this.recorder.stop();\n    return new Promise((resolve) => {\n      this.load_resolver = resolve;\n    });\n  }\n\n  private showPlaybackControls(display_element, trial) {\n    display_element.innerHTML = `\n      <button id=\"record-again\" class=\"jspsych-btn\">${trial.record_again_button_label}</button>\n      <button id=\"continue\" class=\"jspsych-btn\">${trial.accept_button_label}</button>\n    `;\n\n    display_element.querySelector(\"#record-again\").addEventListener(\"click\", () => {\n      // release object url to save memory\n      this.startRecording(trial);\n    });\n    display_element.querySelector(\"#continue\").addEventListener(\"click\", () => {\n      this.endTrial(display_element, trial);\n    });\n\n    // const audio = display_element.querySelector('#playback');\n    // audio.src =\n  }\n\n  private endTrial(display_element, trial) {\n    // clear recordering event handler\n\n    this.recorder.removeEventListener(\"dataavailable\", this.data_available_handler);\n    this.recorder.removeEventListener(\"start\", this.start_event_handler);\n    this.recorder.removeEventListener(\"stop\", this.stop_event_handler);\n\n    // kill any remaining setTimeout handlers\n    this.jsPsych.pluginAPI.clearAllTimeouts();\n\n    // gather the data to store for the trial\n    var trial_data: any = {\n      rt: this.rt,\n      stimulus: trial.stimulus,\n      response: this.response,\n      estimated_stimulus_onset: Math.round(this.stimulus_start_time - this.recorder_start_time),\n    };\n\n    // clear the display\n    display_element.innerHTML = \"\";\n\n    // move on to the next trial\n    this.jsPsych.finishTrial(trial_data);\n  }\n}\n\nexport default HtmlAudioResponsePlugin;\n"],"names":["info","name","parameters","stimulus","type","ParameterType","HTML_STRING","default","undefined","stimulus_duration","INT","recording_duration","show_done_button","BOOL","done_button_label","STRING","record_again_button_label","accept_button_label","allow_playback","save_audio_url","use_voice_key","amplitude_threshold","FLOAT","timer_duration","HtmlAudioResponsePlugin","jsPsych","_classCallCheck","this","rt","recorded_data_chunks","meter","canvasContext","isLoggingAmplitude","amplitudeLoggingTimeoutId","display_element","trial","pluginAPI","audioContext","recorder","getMicrophoneRecorder","setupRecordingEvents","startRecording","_this","ResizeObserver","entries","observer","stimulus_start_time","performance","now","unobserve","observe","console","log","html","toFixed","innerHTML","startAmplitudeLogging","document","getElementById","addEventListener","stopAmplitudeLogging","Math","min","textContent","concat","max","value","el","querySelector","style","visibility","alertImage","opacity","_this2","btn","end_time","round","stopRecording","then","showPlaybackControls","endTrial","_this3","data_available_handler","e","data","size","push","stop_event_handler","Blob","reader","FileReader","base64","result","split","response","load_resolver","readAsDataURL","start_event_handler","length","recorder_start_time","timeStamp","showDisplay","addButtonEvent","setTimeout","hideStimulus","state","amplitude","threshold","getContext","canvas","clearRect","width","height","scaledAmplitude","fillStyle","fillRect","logAmplitudeUntilThresholdReached","message","error","_this4","Promise","resolve","reject","logAmplitude","analyzer","getByteTimeDomainData","dataArray","sum","i","bufferLength","sqrt","drawVolumeMeter","endTime","startTime","Date","timeout","AudioContext","source","createMediaStreamSource","stream","createAnalyser","connect","frequencyBinCount","Uint8Array","start","_this5","stop","_this6","removeEventListener","clearAllTimeouts","trial_data","estimated_stimulus_onset","finishTrial"],"mappings":"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"}